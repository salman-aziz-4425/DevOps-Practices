# for dev environment
server {
  server_name dev-ml.hyly.us;
  listen 80;

  resolver   127.0.0.11;

  location /pai_datascience_services {
    rewrite ^/pai_datascience_services(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://pai_datascience_services_dev:80/;
  }

  location /chatcdp_services {
    rewrite ^/chatcdp_services(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://chatcdp_services_dev:5000/;
  }

  location /chatcdp {
    rewrite ^/chatcdp(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://chatcdp_dev:5000/;
  }

    location /etl_hub {
    rewrite ^/etl_hub(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://etl_hub_dev:3000/;
  }
}


server {
  server_name  dev-ml.hyly.us;
  listen 443 ssl;

  client_max_body_size 10m;
  ssl_session_timeout  5m;

  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;


  ssl_certificate     /etc/nginx/crt/hyly.us.crt;
  ssl_certificate_key /etc/nginx/crt/hyly.us.key;

  resolver   127.0.0.11;

  location /pai_datascience_services {
    rewrite ^/pai_datascience_services(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://pai_datascience_services_dev:80/;
  }

  location /chatcdp_services {
    rewrite ^/chatcdp_services(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://chatcdp_services_dev:5000/;
  }

  location /chatcdp {
    rewrite ^/chatcdp(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://chatcdp_dev:5000/;
  }

    location /etl_hub {
    rewrite ^/etl_hub(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://etl_hub_dev:3000/;
  }
}

# for staging environment
server {
  server_name stg-ml.hyly.us;
  listen 80;

  client_max_body_size 10m;

  resolver   127.0.0.11;

#  location /pai_datascience_services {
#     rewrite ^/pai_datascience_services(.*) /$1 break;
#     proxy_set_header X-Forwarded-For $remote_addr;
#     proxy_set_header Host $http_host;
#     proxy_set_header X_FORWARDED_PROTO http;
#     proxy_redirect off;
#     proxy_read_timeout 600;
#     proxy_pass http://pai_datascience_services_staging:82/;
#   }

  location /chatcdp_services {
    rewrite ^/chatcdp_services(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://chatcdp_services_staging:5000/;
  }

  location /chatcdp {
    rewrite ^/chatcdp(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://chatcdp_staging:5000/;
  }

  location /etl_hub {
    rewrite ^/etl_hub(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://etl_hub_staging:3000/;
  }

  
}


server {
  server_name  stg-ml.hyly.us;
  listen 443 ssl;

  ssl_session_timeout  5m;

  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;


  ssl_certificate     /etc/nginx/crt/hyly.us.crt;
  ssl_certificate_key /etc/nginx/crt/hyly.us.key;

  resolver   127.0.0.11;

  # location /pai_datascience_services {
  #   rewrite ^/pai_datascience_services(.*) /$1 break;
  #   proxy_set_header X-Forwarded-For $remote_addr;
  #   proxy_set_header Host $http_host;
  #   proxy_set_header X_FORWARDED_PROTO http;
  #   proxy_redirect off;
  #   proxy_pass http://pai_datascience_services_staging:82/;
  # }

  location /chatcdp_services {
    rewrite ^/chatcdp_services(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://chatcdp_services_staging:5000/;
  }

  location /chatcdp {
    rewrite ^/chatcdp(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://chatcdp_staging:5000/;
  }


  location /etl_hub {
    rewrite ^/etl_hub(.*) /$1 break;
    proxy_set_header X-Forwarded-For $remote_addr;
    proxy_set_header Host $http_host;
    proxy_set_header X_FORWARDED_PROTO http;
    proxy_redirect off;
    proxy_pass http://etl_hub_staging:3000/;
  }
}