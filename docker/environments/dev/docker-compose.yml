version: '3.4'
services:
    # MySQL Database
    mysql_db_dev: 
      image: mysql:8.0
      restart: always
      environment:
        MYSQL_ALLOW_EMPTY_PASSWORD: true
      ports:
        - "3306:3306"
      volumes:
        - /db_volumes/mysql_data_dev:/var/lib/mysql
      command: --max-allowed-packet=128M
    
    # MongoDB Database
    mongo_db_dev:
      image: mongo:5.0
      restart: always
      ports:
        - "27017:27017"
      volumes:
        - /db_volumes/mongo_data_dev:/data/db
      depends_on:
        - mysql_db_dev

    # chatCDP https://github.com/munishgandhi/chatCDP  
    chatcdp_dev: 
      image: us-east1-docker.pkg.dev/gds-prototype-20190629/ml-dev/chatcdp:latest
      restart: always
      ports:
        - "5000:5000"
        - "6379:6379"
      depends_on:
        - mysql_db_dev
        - mongo_db_dev
    
    # chatCDP services https://github.com/munishgandhi/JAI.GPT.LeaseGPT.MailGPT/tree/main/ChatCDP
    chatcdp_services_dev: 
      image: us-east1-docker.pkg.dev/gds-prototype-20190629/ml-dev/chatcdp-services:latest
      restart: always
      ports:
        - "5010:5000"
      depends_on:
        - mysql_db_dev
        - mongo_db_dev
    
    # https://github.com/munishgandhi/etl-hub/tree/datascience_dev
    pai_datascience_services_dev: 
      image: us-east1-docker.pkg.dev/gds-prototype-20190629/ml-dev/pai-datascience-services:latest
      restart: always
      ports: 
        - "80:80"
        - "8888:8888"
        - "8889:8889"
        - "8890:8890"
      depends_on:
        - mysql_db_dev
        - mongo_db_dev

volumes:
  mysql_data_dev:
    external: true
  mongo_data_dev:
    external: true
    
networks:
  default:
    name: microservices_dev
    external: true